<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Review Popcorn Ultimate</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#121212;
  color:white;
}

header {
  background:#1f1f1f;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

header h2 {
  color:#f5c518;
}

nav button {
  background:#f5c518;
  border:none;
  padding:8px 12px;
  margin:5px;
  font-weight:bold;
  cursor:pointer;
  border-radius:5px;
}

section {
  padding:20px;
}

.search-box {
  text-align:center;
  margin-bottom:20px;
}

.search-box input {
  padding:8px;
  width:250px;
}

.grid {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
}

.movie-card {
  background:#1e1e1e;
  width:260px;
  margin:15px;
  padding:15px;
  border-radius:10px;
  text-align:center;
  box-shadow:0 0 10px rgba(0,0,0,0.5);
}

.movie-card img {
  width:100%;
  border-radius:8px;
}

.movie-card input,
.movie-card select {
  width:90%;
  padding:6px;
  margin:5px 0;
}

.movie-card button {
  width:95%;
  margin-top:5px;
}

.review-box {
  background:#2a2a2a;
  padding:8px;
  margin-top:10px;
  border-radius:6px;
  max-height:150px;
  overflow-y:auto;
}

hr {
  border:0.5px solid #444;
}
</style>
</head>
<body>

<header>
<h2>üçø Review Popcorn</h2>
<nav>
<button onclick="showHome()">Home</button>
<button onclick="showSearch()">Search</button>
<button onclick="showWatchlist()">‚ù§Ô∏è Watchlist</button>
</nav>
</header>

<section id="homeSection">
<h1>Welcome to Review Popcorn üé¨</h1>
<p>Discover ‚Ä¢ Review ‚Ä¢ Save ‚Ä¢ Rate</p>
</section>

<section id="searchSection" style="display:none;">
<div class="search-box">
<input id="searchInput" placeholder="Search movies...">
<button onclick="search()">Search</button>
</div>
<div id="movies" class="grid"></div>
</section>

<section id="watchlistSection" style="display:none;">
<h2>‚ù§Ô∏è Your Watchlist</h2>
<div id="watchlistMovies" class="grid"></div>
</section>

<script>
// =======================
// üî• REPLACE THESE KEYS
// =======================
const OMDB_KEY = "YOUR_OMDB_KEY";

const firebaseConfig = {
  apiKey: "YOUR_FIREBASE_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
};

// =======================
// FIREBASE INIT
// =======================
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// =======================
// NAVIGATION
// =======================
function showHome(){
  homeSection.style.display="block";
  searchSection.style.display="none";
  watchlistSection.style.display="none";
}

function showSearch(){
  homeSection.style.display="none";
  searchSection.style.display="block";
  watchlistSection.style.display="none";
}

function showWatchlist(){
  homeSection.style.display="none";
  searchSection.style.display="none";
  watchlistSection.style.display="block";
  loadWatchlist();
}

// =======================
// SEARCH MOVIES
// =======================
async function search(){
  const query = document.getElementById("searchInput").value;
  if(!query) return alert("Enter movie name");

  const res = await fetch(`https://www.omdbapi.com/?s=${query}&apikey=${OMDB_KEY}`);
  const data = await res.json();

  if(data.Response==="False"){
    alert("Movie not found");
    return;
  }

  displayMovies(data.Search);
}

function displayMovies(movies){
  const container = document.getElementById("movies");
  container.innerHTML="";

  movies.forEach(movie=>{
    container.innerHTML += `
    <div class="movie-card">
      <img src="${movie.Poster}">
      <h3>${movie.Title}</h3>
      <p>${movie.Year}</p>

      <p id="avg-${movie.imdbID}">‚≠ê Avg: Loading...</p>

      <input id="review-${movie.imdbID}" placeholder="Write review">
      <select id="rating-${movie.imdbID}">
        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
        <option value="3">‚≠ê‚≠ê‚≠ê</option>
        <option value="2">‚≠ê‚≠ê</option>
        <option value="1">‚≠ê</option>
      </select>

      <button onclick="addReview('${movie.imdbID}','${movie.Title}')">
      Submit Review
      </button>

      <button onclick="addToWatchlist('${movie.imdbID}','${movie.Title}','${movie.Poster}','${movie.Year}')">
      ‚ù§Ô∏è Add to Watchlist
      </button>

      <div class="review-box" id="reviews-${movie.imdbID}"></div>
    </div>
    `;

    loadReviews(movie.imdbID);
  });
}

// =======================
// ADD REVIEW
// =======================
async function addReview(id,title){
  const text = document.getElementById(`review-${id}`).value;
  const rating = document.getElementById(`rating-${id}`).value;

  if(!text) return alert("Write review first!");

  await db.collection("reviews").add({
    imdbID:id,
    title:title,
    review:text,
    rating:Number(rating),
    date:new Date()
  });

  document.getElementById(`review-${id}`).value="";
  loadReviews(id);
}

// =======================
// LOAD REVIEWS + AVERAGE
// =======================
async function loadReviews(id){
  const snapshot = await db.collection("reviews")
  .where("imdbID","==",id)
  .get();

  let total=0;
  let count=0;
  let html="";

  snapshot.forEach(doc=>{
    const data = doc.data();
    total += data.rating;
    count++;

    html += `<p>${"‚≠ê".repeat(data.rating)} - ${data.review}</p><hr>`;
  });

  document.getElementById(`reviews-${id}`).innerHTML = html;

  const avg = count ? (total/count).toFixed(1) : "0";
  document.getElementById(`avg-${id}`).innerHTML = `‚≠ê Avg: ${avg}`;
}

// =======================
// WATCHLIST
// =======================
async function addToWatchlist(id,title,poster,year){
  await db.collection("watchlist").doc(id).set({
    imdbID:id,
    title:title,
    poster:poster,
    year:year
  });

  alert("Added to Watchlist ‚ù§Ô∏è");
}

async function loadWatchlist(){
  const container = document.getElementById("watchlistMovies");
  container.innerHTML="";

  const snapshot = await db.collection("watchlist").get();

  snapshot.forEach(doc=>{
    const m = doc.data();

    container.innerHTML += `
      <div class="movie-card">
        <img src="${m.poster}">
        <h3>${m.title}</h3>
        <p>${m.year}</p>
      </div>
    `;
  });
}
</script>

</body>
</html>
