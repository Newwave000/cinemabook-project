<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Write Your Review </title>
  <style>
    body { font-family: Arial; margin:0; background:#f8f8f8; }
    header { background:#e50914; color:white; padding:20px; text-align:center; }
    .search { margin: 20px; text-align:center; }
    .search input { width:300px; padding:10px; font-size:16px; }
    .movies { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; padding:20px; }
    .movie { background:white; width:200px; border-radius:10px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.2); }
    .movie img { width:100%; }
    .movie-info { padding:10px; }
    .rating { font-weight:bold; color:#e50914; }
    .reviews { padding:10px; border-top:1px solid #eee; max-height:200px; overflow-y:auto; }
    .review { margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px; }
    button { background:#e50914; color:white; border:none; padding:5px 10px; cursor:pointer; border-radius:5px; }
  </style>
</head>
<body>

<header>
  <h1>Write Your Review</h1>
</header>

<div class="search">
  <input type="text" id="searchInput" placeholder="Search movies..." />
  <button onclick="searchMovies()">Search</button>
</div>

<div class="movies" id="movies"></div>

<script>
const apiKey = '88e73149'; // ✅ Your OMDb API key
const moviesDiv = document.getElementById('movies');

// Search movies
async function searchMovies() {
  const query = document.getElementById('searchInput').value;
  if(!query) return;
  moviesDiv.innerHTML = 'Loading...';

  const res = await fetch(`https://www.omdbapi.com/?s=${encodeURIComponent(query)}&apikey=${apiKey}`);
  const data = await res.json();

  if(data.Response === "True"){
    displayMovies(data.Search);
  } else {
    moviesDiv.innerHTML = '<p>No movies found.</p>';
  }
}

// Display movies
function displayMovies(movies){
  moviesDiv.innerHTML = '';
  movies.forEach(movie=>{
    const movieDiv = document.createElement('div');
    movieDiv.className = 'movie';
    
    // Load reviews from localStorage
    const reviews = JSON.parse(localStorage.getItem('reviews-'+movie.imdbID) || '[]');

    movieDiv.innerHTML = `
      <img src="${movie.Poster !== "N/A" ? movie.Poster : ''}" alt="${movie.Title}" />
      <div class="movie-info">
        <h3>${movie.Title} (${movie.Year})</h3>
        <p class="rating">Rating: ${reviews.length ? (reviews.reduce((a,b)=>a+Number(b.rating),0)/reviews.length).toFixed(1) : 'N/A'} ⭐</p>
        <form id="form-${movie.imdbID}">
          <input type="text" placeholder="Your Name" name="name" required/>
          <input type="number" placeholder="Rating 1-5" name="rating" min="1" max="5" required/>
          <textarea placeholder="Comment" name="comment" required></textarea>
          <button type="submit">Add Review</button>
        </form>
        <div class="reviews" id="reviews-${movie.imdbID}"></div>
      </div>
    `;
    moviesDiv.appendChild(movieDiv);

    // Render existing reviews
    const reviewsDiv = document.getElementById(`reviews-${movie.imdbID}`);
    reviews.forEach(r=>{
      const rDiv = document.createElement('div');
      rDiv.className = 'review';
      rDiv.innerHTML = `<strong>${r.name} ⭐ ${r.rating}</strong><p>${r.comment}</p>`;
      reviewsDiv.appendChild(rDiv);
    });

    // Handle form submit
    const form = document.getElementById(`form-${movie.imdbID}`);
    form.addEventListener('submit', function(e){
      e.preventDefault();
      const name = this.name.value;
      const rating = this.rating.value;
      const comment = this.comment.value;
      reviews.push({name, rating, comment});
      localStorage.setItem('reviews-'+movie.imdbID, JSON.stringify(reviews));
      searchMovies(); // reload movies to show updated reviews
    });
  });
}
</script>

</body>
</html>
